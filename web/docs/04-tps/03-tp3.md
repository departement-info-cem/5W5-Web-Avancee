# TP3 (Super suite de Super Cartes Infinies)


## Partie commune (évaluation plus tôt)
4% sur le TDD
- Il faut ajouter au moins un test complet pour chacun des pouvoirs. C’est une bonne idée de travailler en Test Driven Development et d’écrire les tests d’abord.
    **Faire au moins un Power qui est full random et qui utilise un Mock pour les tests**
2% sur AzureDevops

- Diagramme de classes? (Probablement pas...)

- Vérifier que la gestion de l'index est bien fait pour le BattleField


## Tâches individuelles
:::warning
La tâche d'habiletés supplémentaires doit être fait par un autre étudiant que celui qui a fait la logique de jeu au TP2
:::
- Habiletés supplémentaires [obligatoire] 
- Statistiques des joueurs
- Matchmaking
- Chat et mode spectateur

## Statistiques des joueurs
- Un joueur aura la possibilité de voir des statistiques à propos de ses decks ou de l’ensemble de ses cartes
    - Il pourra voir le nombre de victoire et défaites avec ce deck (ou général)
    - La distribution des cartes (En utilisant des graphs similaires):
        - Coût
        - Rareté
        - Attaque et défense
- Vous pouvez utiliser la technologie de graph que vous préférez, mais on propose la suivante : https://canvasjs.com/angular-charts/pie-chart-index-data-label/ 

### Lorsqu’on affiche l’ensemble des cartes

|![alt text](/img/tps/tp3/image-1.png)|
|-|

### Lorsque l’on sélectionne un deck

|![alt text](/img/tps/tp3/image-2.png)|
|-|

 
### Habilités supplémentaires
- Il y aura l’ajout d’habilités pour les cartes qui vont modifier un état. 
    - Poison X, qui ajoute une valeur de poison à la carte attaquée. Le poison diminue ensuite la vie d’une carte de la valeur du poison à la fin de son activation. Si une carte a déjà une valeur de poison et qu’elle est à nouveau attaquée, la valeur de poison est augmentée.
    - Stunned X, qui empêche une carte d’agir pendant son activation durant X tours. (Mais elle reçoit quand même les dégâts de poison!)
    - Holy Shield, qui protège la carte en bloquant 100% des dégâts la prochaine fois qu’elle en reçoit et disparait après.
**Modifier pour de véritables cartes instantanées**
- Il y aura également l’ajout de cartes qui auront un effet immédiat et qui se déplaceront directement dans le « graveyard » par la suite (On n’attend pas la fin du tour).
    - Lightning Strike X, fait X dégâts au joueur adverse. (Attention, c’est possible que la partie se termine)
    - Earthquake X, fait X dégâts à TOUTES les cartes en jeu.
    - Magical Hammer X, fait X dégâts à une carte adverse.

**Boost de l'attaque des cartes**
**Ramener une carte du graveyard**
**Faire au moins un Power qui est full random et qui utilise un Mock pour les tests**



### Chat, Status (Content, Faché, Amusé, etc), Mode spectateur

- Chat dans un menu sur le côté avec les messages et la liste des gens présent (Les spectateurs peuvent écrire aussi, mais les joueurs peuvent les banir de la partie)
  - On peut également faire Mute, pour ne plus affiche les messages d'un joueur sur notre client pour cette partie
- Status avec 4 ou 5 icônes pour changer et une animation sur les 2 clients
- Liste des parties actives avec l'option de les regarder
- Voir seulement les cartes que l'on peut jouer de notre main? (avec un halo ou quelque chose) (Assez de Mana)

### Rankings ELO et Matchmaking

(Voir l'ancien document de TP3 (A23) qui était trop long)
Faire aussi un système de matchmaking différent qui prend des joueurs avec un ELO plus loin du notre avec le temps
- Doit écrire des tests pour ce système la aussi!
- Utiliser une **BACKGROUND TASK**
- Afficher aussi une page avec les meilleurs joueurs et une page avec les meilleurs joueurs prêt de nous
- Afficher le changement de ELO après chaque Match!

- 	Calculer son ELO (voir prochaine page) après chaque match et avoir un leaderboard (les 8 meilleurs joueurs et les 4 au-dessus et 3 en-dessous).
- 	Ajouter un seed avec au moins 10 joueurs qui ont des scores ELO différents
- 	Identifier l’utilisateur dans la liste de position (et celle des meilleurs joueurs, s’il en fait partie)
- 	Cas spécial : si l’utilisateur est un des 5 meilleurs joueurs, le tableau de « Ta position » montre également les 8 meilleures joueurs.
 

 
Pour le calcul du score ELO, faites commencer les joueurs avec un score de 1000.
Par la suite, après chaque match, utiliser cette méthode pour calculer le nouveau score des 2 joueurs.

```csharp
public class EloCalculator
{
    public enum GameOutcome
    {
        Win = 1,
        Loss = 0
    }

    public static void CalculateELO(ref int p1Rating, ref int p2Rating, GameOutcome p1Outcome)
    {
        int eloK = 32;

        double expectation = ExpectationToWin(p1Rating, p2Rating);
        int delta = (int)(eloK * ((int)p1Outcome - expectation));

        p1Rating += delta;
        p2Rating -= delta;
    }

    private static double ExpectationToWin(int p1Rating, int p2Rating)
    {
        return 1 / (1 + Math.Pow(10, (p2Rating - p1Rating) / 400.0));
    }
}
```

